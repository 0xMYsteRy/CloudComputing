{"ast":null,"code":"import _regeneratorRuntime from\"/Users/mystery/Desktop/bookstore-v2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Users/mystery/Desktop/bookstore-v2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/Users/mystery/Desktop/bookstore-v2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/mystery/Desktop/bookstore-v2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useContext}from\"react\";import{useHistory}from\"react-router-dom\";import{BookContext}from\"../context/books\";import{CartContext}from\"../context/cart\";import{CardElement,useElements,useStripe}from\"@stripe/react-stripe-js\";var CARD_ELEMENT_OPTIONS={style:{base:{color:\"#32325d\",fontFamily:'\"Helvetica Neue\", Helvetica, sans-serif',fontSmoothing:\"antialiased\",fontSize:\"16px\",\"::placeholder\":{color:\"#aab7c4\"}},invalid:{color:\"#fa755a\",iconColor:\"#fa755a\"}}};var CheckoutForm=function CheckoutForm(){var _useContext=useContext(CartContext),cart=_useContext.cart,total=_useContext.total,clearCart=_useContext.clearCart;var _useContext2=useContext(BookContext),checkout=_useContext2.checkout;var _useState=useState({cart:cart,total:total,address:null,token:null}),_useState2=_slicedToArray(_useState,2),orderDetails=_useState2[0],setOrderDetails=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],setError=_useState4[1];var stripe=useStripe();var elements=useElements();var history=useHistory();useEffect(function(){if(orderDetails.token){checkout(orderDetails);//clearCart();\n//history.push(\"/\");\n}},[orderDetails]);// Handle real-time validation errors from the card Element.\nvar handleChange=function handleChange(event){if(event.error){setError(event.error.message);}else{setError(null);}};// Handle form submission.\nvar handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var card,result,token;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();card=elements.getElement(CardElement);_context.next=4;return stripe.createToken(card);case 4:result=_context.sent;if(result.error){// Inform the user if there was an error.\nsetError(result.error.message);}else{setError(null);// Send the token to your server.\ntoken=result.token;setOrderDetails(_objectSpread(_objectSpread({},orderDetails),{},{token:token.id}));}case 6:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(\"form\",{onSubmit:handleSubmit},/*#__PURE__*/React.createElement(\"div\",{className:\"checkout-form\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"checkout-address\"},\"Shipping Address\"),/*#__PURE__*/React.createElement(\"input\",{id:\"checkout-address\",type:\"text\",onChange:function onChange(e){return setOrderDetails(_objectSpread(_objectSpread({},orderDetails),{},{address:e.target.value}));}}),/*#__PURE__*/React.createElement(\"div\",{className:\"stripe-section\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"stripe-element\"},\" Credit or debit card \"),/*#__PURE__*/React.createElement(CardElement,{id:\"stripe-element\",options:CARD_ELEMENT_OPTIONS,onChange:handleChange})),/*#__PURE__*/React.createElement(\"div\",{className:\"card-errors\",role:\"alert\"},error)),/*#__PURE__*/React.createElement(\"button\",{type:\"submit\",className:\"btn\"},\"Submit Payment\"));};export default CheckoutForm;","map":{"version":3,"sources":["/Users/mystery/Desktop/bookstore-v2/src/components/CheckoutForm.js"],"names":["React","useState","useEffect","useContext","useHistory","BookContext","CartContext","CardElement","useElements","useStripe","CARD_ELEMENT_OPTIONS","style","base","color","fontFamily","fontSmoothing","fontSize","invalid","iconColor","CheckoutForm","cart","total","clearCart","checkout","address","token","orderDetails","setOrderDetails","error","setError","stripe","elements","history","handleChange","event","message","handleSubmit","preventDefault","card","getElement","createToken","result","id","e","target","value"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { BookContext } from \"../context/books\";\nimport { CartContext } from \"../context/cart\";\nimport { CardElement, useElements, useStripe } from \"@stripe/react-stripe-js\";\n\nconst CARD_ELEMENT_OPTIONS = {\n  style: {\n    base: {\n      color: \"#32325d\",\n      fontFamily: '\"Helvetica Neue\", Helvetica, sans-serif',\n      fontSmoothing: \"antialiased\",\n      fontSize: \"16px\",\n      \"::placeholder\": {\n        color: \"#aab7c4\"\n      }\n    },\n    invalid: {\n      color: \"#fa755a\",\n      iconColor: \"#fa755a\"\n    }\n  }\n};\n\nconst CheckoutForm = () => {\n  const { cart, total, clearCart } = useContext(CartContext);\n  const { checkout } = useContext(BookContext);\n  const [orderDetails, setOrderDetails] = useState({ cart, total, address: null, token: null });\n  const [error, setError] = useState(null);\n  const stripe = useStripe();\n  const elements = useElements();\n  const history = useHistory();\n\n  useEffect(() => {\n    if (orderDetails.token) {\n      checkout(orderDetails);\n      //clearCart();\n      //history.push(\"/\");\n    }\n  }, [orderDetails]);\n\n  // Handle real-time validation errors from the card Element.\n  const handleChange = (event) => {\n    if (event.error) {\n      setError(event.error.message);\n    } else {\n      setError(null);\n    }\n  };\n\n  // Handle form submission.\n  const handleSubmit = async (event) => {\n    event.preventDefault();\n    const card = elements.getElement(CardElement);\n    const result = await stripe.createToken(card);\n    if (result.error) {\n      // Inform the user if there was an error.\n      setError(result.error.message);\n    } else {\n      setError(null);\n      // Send the token to your server.\n      const token = result.token;\n      setOrderDetails({ ...orderDetails, token: token.id });\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit}>\n      <div className=\"checkout-form\">\n        <label htmlFor=\"checkout-address\">Shipping Address</label>\n        <input\n          id=\"checkout-address\"\n          type=\"text\"\n          onChange={(e) => setOrderDetails({ ...orderDetails, address: e.target.value })}\n        />\n        <div className=\"stripe-section\">\n          <label htmlFor=\"stripe-element\"> Credit or debit card </label>\n          <CardElement id=\"stripe-element\" options={CARD_ELEMENT_OPTIONS} onChange={handleChange} />\n        </div>\n        <div className=\"card-errors\" role=\"alert\">\n          {error}\n        </div>\n      </div>\n      <button type=\"submit\" className=\"btn\">\n        Submit Payment\n      </button>\n    </form>\n  );\n};\n\nexport default CheckoutForm;\n"]},"metadata":{},"sourceType":"module"}